const CONTINENTS = [
  {
    fill: '#3ba372',
    stroke: 'rgba(18, 60, 38, 0.9)',
    polygons: [
      [
        [-168, 71],
        [-150, 72],
        [-140, 70],
        [-128, 60],
        [-120, 58],
        [-110, 50],
        [-105, 43],
        [-100, 36],
        [-98, 30],
        [-94, 25],
        [-90, 20],
        [-86, 16],
        [-82, 20],
        [-85, 26],
        [-90, 32],
        [-97, 38],
        [-103, 42],
        [-110, 48],
        [-118, 54],
        [-130, 60],
        [-140, 65],
        [-150, 68],
        [-160, 70],
      ],
      [
        [-83, 23],
        [-81, 21],
        [-78, 19],
        [-77, 17],
        [-76, 15],
        [-78, 13],
        [-81, 12],
        [-84, 15],
      ],
      [
        [-81, 10],
        [-78, 7],
        [-77, 4],
        [-78, 1],
        [-80, -4],
        [-82, -5],
        [-85, -3],
        [-85, 2],
        [-84, 6],
      ],
      [
        [-66, 54],
        [-60, 55],
        [-54, 58],
        [-50, 60],
        [-48, 62],
        [-45, 64],
        [-40, 66],
        [-34, 67],
        [-30, 68],
        [-32, 72],
        [-40, 74],
        [-48, 75],
        [-56, 74],
        [-62, 70],
        [-66, 60],
      ],
    ],
  },
  {
    fill: '#36a36b',
    stroke: 'rgba(16, 68, 40, 0.9)',
    polygons: [
      [
        [-81, 12],
        [-78, 7],
        [-74, 5],
        [-72, 2],
        [-68, -4],
        [-66, -12],
        [-64, -18],
        [-62, -24],
        [-60, -32],
        [-60, -40],
        [-62, -48],
        [-66, -54],
        [-72, -56],
        [-78, -54],
        [-80, -48],
        [-82, -40],
        [-82, -30],
        [-80, -20],
        [-78, -12],
        [-76, -4],
        [-78, 2],
      ],
    ],
  },
  {
    fill: '#3ca76e',
    stroke: 'rgba(18, 64, 40, 0.85)',
    polygons: [
      [
        [-10, 71],
        [-5, 68],
        [6, 65],
        [18, 63],
        [30, 60],
        [40, 58],
        [50, 60],
        [60, 58],
        [70, 55],
        [80, 50],
        [90, 48],
        [100, 50],
        [110, 48],
        [120, 46],
        [130, 45],
        [140, 45],
        [150, 50],
        [160, 52],
        [170, 55],
        [170, 60],
        [160, 62],
        [150, 63],
        [140, 64],
        [130, 62],
        [120, 60],
        [110, 60],
        [100, 62],
        [90, 64],
        [80, 66],
        [70, 68],
        [60, 68],
        [50, 70],
        [40, 72],
        [30, 72],
        [20, 72],
        [10, 73],
        [0, 74],
      ],
      [
        [-10, 37],
        [0, 40],
        [10, 42],
        [20, 44],
        [30, 46],
        [40, 48],
        [50, 50],
        [60, 50],
        [70, 46],
        [80, 42],
        [90, 38],
        [100, 36],
        [110, 34],
        [120, 32],
        [130, 30],
        [138, 28],
        [140, 20],
        [136, 12],
        [130, 8],
        [120, 6],
        [110, 6],
        [100, 10],
        [90, 12],
        [80, 10],
        [70, 8],
        [60, 6],
        [50, 6],
        [40, 10],
        [30, 12],
        [20, 16],
        [10, 18],
        [0, 20],
        [-10, 22],
        [-18, 24],
        [-20, 30],
        [-18, 34],
      ],
      [
        [40, 10],
        [44, 12],
        [48, 8],
        [50, 2],
        [48, -4],
        [44, -8],
        [40, -6],
        [38, 0],
      ],
      [
        [60, -10],
        [70, -8],
        [80, -6],
        [90, -4],
        [100, -2],
        [108, -6],
        [110, -12],
        [106, -18],
        [100, -20],
        [94, -20],
        [86, -18],
        [78, -16],
        [70, -14],
        [62, -12],
      ],
    ],
  },
  {
    fill: '#3aa069',
    stroke: 'rgba(16, 66, 38, 0.85)',
    polygons: [
      [
        [-18, 34],
        [-10, 30],
        [-2, 28],
        [6, 24],
        [12, 20],
        [16, 14],
        [20, 10],
        [24, 4],
        [28, -2],
        [30, -10],
        [32, -18],
        [34, -24],
        [30, -30],
        [26, -36],
        [20, -40],
        [14, -42],
        [8, -40],
        [2, -36],
        [-4, -32],
        [-10, -26],
        [-14, -18],
        [-16, -10],
        [-18, -2],
        [-18, 6],
        [-20, 14],
        [-20, 24],
      ],
    ],
  },
  {
    fill: '#34a46d',
    stroke: 'rgba(12, 60, 34, 0.8)',
    polygons: [
      [
        [110, -10],
        [120, -14],
        [132, -18],
        [140, -22],
        [150, -26],
        [158, -28],
        [162, -24],
        [158, -18],
        [150, -16],
        [142, -12],
        [134, -8],
        [128, -4],
        [122, 0],
        [116, 2],
        [110, 0],
      ],
      [
        [146, -36],
        [154, -38],
        [160, -40],
        [164, -44],
        [160, -48],
        [152, -46],
        [146, -42],
      ],
      [
        [112, -32],
        [118, -34],
        [124, -36],
        [128, -40],
        [122, -44],
        [116, -42],
      ],
    ],
  },
  {
    fill: '#88c9a6',
    stroke: 'rgba(90, 140, 120, 0.8)',
    polygons: [
      [
        [-170, -72],
        [-160, -70],
        [-150, -68],
        [-140, -66],
        [-130, -68],
        [-120, -70],
        [-110, -72],
        [-100, -74],
        [-90, -76],
        [-80, -78],
        [-70, -80],
        [-60, -82],
        [-50, -84],
        [-40, -84],
        [-30, -82],
        [-20, -80],
        [-10, -78],
        [0, -78],
        [10, -80],
        [20, -82],
        [30, -84],
        [40, -82],
        [50, -80],
        [60, -78],
        [70, -76],
        [80, -74],
        [90, -72],
        [100, -70],
        [110, -72],
        [120, -74],
        [130, -76],
        [140, -78],
        [150, -80],
        [160, -82],
        [170, -82],
        [-180, -82],
      ],
    ],
  },
];

function project(lon, lat, width, height) {
  const x = ((lon + 180) / 360) * width;
  const y = ((90 - lat) / 180) * height;
  return [x, y];
}

function drawOceans(ctx, width, height) {
  const gradient = ctx.createLinearGradient(0, 0, 0, height);
  gradient.addColorStop(0, '#082f49');
  gradient.addColorStop(0.5, '#072541');
  gradient.addColorStop(1, '#061d34');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, width, height);

  ctx.save();
  ctx.globalAlpha = 0.18;
  ctx.fillStyle = '#0ea5e9';
  for (let lat = -60; lat <= 60; lat += 20) {
    const y = project(0, lat, width, height)[1];
    ctx.fillRect(0, y - 1, width, 2);
  }
  ctx.restore();
}

function drawContinents(ctx, width, height) {
  CONTINENTS.forEach((feature) => {
    ctx.save();
    ctx.fillStyle = feature.fill;
    ctx.strokeStyle = feature.stroke;
    ctx.lineWidth = 1.4;
    feature.polygons.forEach((polygon) => {
      ctx.beginPath();
      polygon.forEach(([lon, lat], index) => {
        const [x, y] = project(lon, lat, width, height);
        if (index === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    });
    ctx.restore();
  });
}

function drawShading(ctx, width, height) {
  ctx.save();
  const vignette = ctx.createRadialGradient(
    width * 0.6,
    height * 0.45,
    width * 0.2,
    width * 0.5,
    height * 0.5,
    width * 0.7
  );
  vignette.addColorStop(0, 'rgba(0, 0, 0, 0)');
  vignette.addColorStop(1, 'rgba(0, 0, 0, 0.4)');
  ctx.globalCompositeOperation = 'multiply';
  ctx.fillStyle = vignette;
  ctx.fillRect(0, 0, width, height);
  ctx.restore();

  ctx.save();
  ctx.globalAlpha = 0.18;
  ctx.fillStyle = '#f8fafc';
  for (let lon = -180; lon < 180; lon += 30) {
    const [x] = project(lon, 0, width, height);
    ctx.fillRect(x - 1, 0, 2, height);
  }
  ctx.restore();
}

function drawIceCaps(ctx, width, height) {
  ctx.save();
  const gradientNorth = ctx.createLinearGradient(0, 0, 0, height * 0.15);
  gradientNorth.addColorStop(0, 'rgba(241, 245, 249, 0.85)');
  gradientNorth.addColorStop(1, 'rgba(226, 232, 240, 0)');
  ctx.fillStyle = gradientNorth;
  ctx.fillRect(0, 0, width, height * 0.15);

  const gradientSouth = ctx.createLinearGradient(0, height, 0, height * 0.85);
  gradientSouth.addColorStop(0, 'rgba(226, 232, 240, 0.85)');
  gradientSouth.addColorStop(1, 'rgba(226, 232, 240, 0)');
  ctx.fillStyle = gradientSouth;
  ctx.fillRect(0, height * 0.85, width, height * 0.15);
  ctx.restore();
}

export function createEarthTexture(THREE) {
  const width = 2048;
  const height = 1024;
  const canvas = document.createElement('canvas');
  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext('2d');

  drawOceans(ctx, width, height);
  drawContinents(ctx, width, height);
  drawShading(ctx, width, height);
  drawIceCaps(ctx, width, height);

  const texture = new THREE.CanvasTexture(canvas);
  texture.colorSpace = THREE.SRGBColorSpace;
  texture.wrapS = THREE.RepeatWrapping;
  texture.wrapT = THREE.ClampToEdgeWrapping;
  texture.anisotropy = 4;
  texture.needsUpdate = true;
  return texture;
}
